{"version":3,"file":"checkPropertyNames.cjs","names":["_iterateJsdoc","_interopRequireDefault","require","e","__esModule","default","validatePropertyNames","targetTagName","enableFixer","jsdoc","utils","jsdocTypedefs","getJsdocTagsDeep","propertyTagGroups","length","map","idx","index","Object","entries","tags","slice","some","propertyTagGroup","propertyTags","filter","tag","tagsIndex","dupeTagInfo","find","tgsIndex","tg","Number","name","reportJSDoc","removeTag","validatePropertyNamesDeep","jsdocPropertyNames","report","lastRealProperty","jsdocPropertyName","isPropertyPath","includes","pathRootNodeName","indexOf","endsWith","_default","exports","iterateJsdoc","context","options","jsdocPropertyNamesDeep","getPreferredTagName","tagName","isError","iterateAllJsdocs","meta","docs","description","url","fixable","schema","additionalProperties","properties","type","module"],"sources":["../../src/rules/checkPropertyNames.js"],"sourcesContent":["import iterateJsdoc from '../iterateJsdoc.js';\n\n/**\n * @param {string} targetTagName\n * @param {boolean} enableFixer\n * @param {import('comment-parser').Block} jsdoc\n * @param {import('../iterateJsdoc.js').Utils} utils\n * @returns {boolean}\n */\nconst validatePropertyNames = (\n  targetTagName,\n  enableFixer,\n  jsdoc, utils,\n) => {\n  const jsdocTypedefs = utils.getJsdocTagsDeep('typedef');\n  let propertyTagGroups;\n  if (jsdocTypedefs && jsdocTypedefs.length > 1) {\n    propertyTagGroups = jsdocTypedefs.map(({\n      idx,\n    }, index) => {\n      return Object.entries(jsdoc.tags).slice(idx, jsdocTypedefs[index + 1]?.idx);\n    });\n  } else {\n    propertyTagGroups = [\n      Object.entries(jsdoc.tags),\n    ];\n  }\n\n  return propertyTagGroups.some((propertyTagGroup) => {\n    const propertyTags = propertyTagGroup.filter(([\n      , tag,\n    ]) => {\n      return tag.tag === targetTagName;\n    });\n\n    return propertyTags.some(([\n      , tag,\n    ], index) => {\n      /** @type {import('../iterateJsdoc.js').Integer} */\n      let tagsIndex;\n      const dupeTagInfo = propertyTags.find(([\n        tgsIndex,\n        tg,\n      ], idx) => {\n        tagsIndex = Number(tgsIndex);\n\n        return tg.name === tag.name && idx !== index;\n      });\n      if (dupeTagInfo) {\n        utils.reportJSDoc(`Duplicate @${targetTagName} \"${tag.name}\"`, dupeTagInfo[1], enableFixer ? () => {\n          utils.removeTag(tagsIndex);\n        } : null);\n\n        return true;\n      }\n\n      return false;\n    });\n  });\n};\n\n/**\n * @param {string} targetTagName\n * @param {{\n *   idx: number;\n *   name: string;\n *   type: string;\n * }[]} jsdocPropertyNames\n * @param {import('comment-parser').Block} jsdoc\n * @param {import('../iterateJsdoc.js').Report} report\n */\nconst validatePropertyNamesDeep = (\n  targetTagName,\n  jsdocPropertyNames, jsdoc, report,\n) => {\n  /** @type {string} */\n  let lastRealProperty;\n\n  return jsdocPropertyNames.some(({\n    idx,\n    name: jsdocPropertyName,\n  }) => {\n    const isPropertyPath = jsdocPropertyName.includes('.');\n\n    if (isPropertyPath) {\n      if (!lastRealProperty) {\n        report(`@${targetTagName} path declaration (\"${jsdocPropertyName}\") appears before any real property.`, null, jsdoc.tags[idx]);\n\n        return true;\n      }\n\n      let pathRootNodeName = jsdocPropertyName.slice(0, jsdocPropertyName.indexOf('.'));\n\n      if (pathRootNodeName.endsWith('[]')) {\n        pathRootNodeName = pathRootNodeName.slice(0, -2);\n      }\n\n      if (pathRootNodeName !== lastRealProperty) {\n        report(\n          `@${targetTagName} path declaration (\"${jsdocPropertyName}\") root node name (\"${pathRootNodeName}\") ` +\n          `does not match previous real property name (\"${lastRealProperty}\").`,\n          null,\n          jsdoc.tags[idx],\n        );\n\n        return true;\n      }\n    } else {\n      lastRealProperty = jsdocPropertyName;\n    }\n\n    return false;\n  });\n};\n\nexport default iterateJsdoc(({\n  context,\n  jsdoc,\n  report,\n  utils,\n}) => {\n  const {\n    enableFixer = false,\n  } = context.options[0] || {};\n  const jsdocPropertyNamesDeep = utils.getJsdocTagsDeep('property');\n  if (!jsdocPropertyNamesDeep || !jsdocPropertyNamesDeep.length) {\n    return;\n  }\n\n  const targetTagName = /** @type {string} */ (utils.getPreferredTagName({\n    tagName: 'property',\n  }));\n  const isError = validatePropertyNames(\n    targetTagName,\n    enableFixer,\n    jsdoc,\n    utils,\n  );\n\n  if (isError) {\n    return;\n  }\n\n  validatePropertyNamesDeep(\n    targetTagName, jsdocPropertyNamesDeep, jsdoc, report,\n  );\n}, {\n  iterateAllJsdocs: true,\n  meta: {\n    docs: {\n      description: 'Ensures that property names in JSDoc are not duplicated on the same block and that nested properties have defined roots.',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc/blob/main/docs/rules/check-property-names.md#repos-sticky-header',\n    },\n    fixable: 'code',\n    schema: [\n      {\n        additionalProperties: false,\n        properties: {\n          enableFixer: {\n            description: `Set to \\`true\\` to auto-remove \\`@property\\` duplicates (based on\nidentical names).\n\nNote that this option will remove duplicates of the same name even if\nthe definitions do not match in other ways (e.g., the second property will\nbe removed even if it has a different type or description).`,\n            type: 'boolean',\n          },\n        },\n        type: 'object',\n      },\n    ],\n    type: 'suggestion',\n  },\n});\n"],"mappings":";;;;;;AAAA,IAAAA,aAAA,GAAAC,sBAAA,CAAAC,OAAA;AAA8C,SAAAD,uBAAAE,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAE9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMG,qBAAqB,GAAGA,CAC5BC,aAAa,EACbC,WAAW,EACXC,KAAK,EAAEC,KAAK,KACT;EACH,MAAMC,aAAa,GAAGD,KAAK,CAACE,gBAAgB,CAAC,SAAS,CAAC;EACvD,IAAIC,iBAAiB;EACrB,IAAIF,aAAa,IAAIA,aAAa,CAACG,MAAM,GAAG,CAAC,EAAE;IAC7CD,iBAAiB,GAAGF,aAAa,CAACI,GAAG,CAAC,CAAC;MACrCC;IACF,CAAC,EAAEC,KAAK,KAAK;MACX,OAAOC,MAAM,CAACC,OAAO,CAACV,KAAK,CAACW,IAAI,CAAC,CAACC,KAAK,CAACL,GAAG,EAAEL,aAAa,CAACM,KAAK,GAAG,CAAC,CAAC,EAAED,GAAG,CAAC;IAC7E,CAAC,CAAC;EACJ,CAAC,MAAM;IACLH,iBAAiB,GAAG,CAClBK,MAAM,CAACC,OAAO,CAACV,KAAK,CAACW,IAAI,CAAC,CAC3B;EACH;EAEA,OAAOP,iBAAiB,CAACS,IAAI,CAAEC,gBAAgB,IAAK;IAClD,MAAMC,YAAY,GAAGD,gBAAgB,CAACE,MAAM,CAAC,CAAC,GAC1CC,GAAG,CACN,KAAK;MACJ,OAAOA,GAAG,CAACA,GAAG,KAAKnB,aAAa;IAClC,CAAC,CAAC;IAEF,OAAOiB,YAAY,CAACF,IAAI,CAAC,CAAC,GACtBI,GAAG,CACN,EAAET,KAAK,KAAK;MACX;MACA,IAAIU,SAAS;MACb,MAAMC,WAAW,GAAGJ,YAAY,CAACK,IAAI,CAAC,CAAC,CACrCC,QAAQ,EACRC,EAAE,CACH,EAAEf,GAAG,KAAK;QACTW,SAAS,GAAGK,MAAM,CAACF,QAAQ,CAAC;QAE5B,OAAOC,EAAE,CAACE,IAAI,KAAKP,GAAG,CAACO,IAAI,IAAIjB,GAAG,KAAKC,KAAK;MAC9C,CAAC,CAAC;MACF,IAAIW,WAAW,EAAE;QACflB,KAAK,CAACwB,WAAW,CAAC,cAAc3B,aAAa,KAAKmB,GAAG,CAACO,IAAI,GAAG,EAAEL,WAAW,CAAC,CAAC,CAAC,EAAEpB,WAAW,GAAG,MAAM;UACjGE,KAAK,CAACyB,SAAS,CAACR,SAAS,CAAC;QAC5B,CAAC,GAAG,IAAI,CAAC;QAET,OAAO,IAAI;MACb;MAEA,OAAO,KAAK;IACd,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMS,yBAAyB,GAAGA,CAChC7B,aAAa,EACb8B,kBAAkB,EAAE5B,KAAK,EAAE6B,MAAM,KAC9B;EACH;EACA,IAAIC,gBAAgB;EAEpB,OAAOF,kBAAkB,CAACf,IAAI,CAAC,CAAC;IAC9BN,GAAG;IACHiB,IAAI,EAAEO;EACR,CAAC,KAAK;IACJ,MAAMC,cAAc,GAAGD,iBAAiB,CAACE,QAAQ,CAAC,GAAG,CAAC;IAEtD,IAAID,cAAc,EAAE;MAClB,IAAI,CAACF,gBAAgB,EAAE;QACrBD,MAAM,CAAC,IAAI/B,aAAa,uBAAuBiC,iBAAiB,sCAAsC,EAAE,IAAI,EAAE/B,KAAK,CAACW,IAAI,CAACJ,GAAG,CAAC,CAAC;QAE9H,OAAO,IAAI;MACb;MAEA,IAAI2B,gBAAgB,GAAGH,iBAAiB,CAACnB,KAAK,CAAC,CAAC,EAAEmB,iBAAiB,CAACI,OAAO,CAAC,GAAG,CAAC,CAAC;MAEjF,IAAID,gBAAgB,CAACE,QAAQ,CAAC,IAAI,CAAC,EAAE;QACnCF,gBAAgB,GAAGA,gBAAgB,CAACtB,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;MAClD;MAEA,IAAIsB,gBAAgB,KAAKJ,gBAAgB,EAAE;QACzCD,MAAM,CACJ,IAAI/B,aAAa,uBAAuBiC,iBAAiB,uBAAuBG,gBAAgB,KAAK,GACrG,gDAAgDJ,gBAAgB,KAAK,EACrE,IAAI,EACJ9B,KAAK,CAACW,IAAI,CAACJ,GAAG,CAChB,CAAC;QAED,OAAO,IAAI;MACb;IACF,CAAC,MAAM;MACLuB,gBAAgB,GAAGC,iBAAiB;IACtC;IAEA,OAAO,KAAK;EACd,CAAC,CAAC;AACJ,CAAC;AAAC,IAAAM,QAAA,GAAAC,OAAA,CAAA1C,OAAA,GAEa,IAAA2C,qBAAY,EAAC,CAAC;EAC3BC,OAAO;EACPxC,KAAK;EACL6B,MAAM;EACN5B;AACF,CAAC,KAAK;EACJ,MAAM;IACJF,WAAW,GAAG;EAChB,CAAC,GAAGyC,OAAO,CAACC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;EAC5B,MAAMC,sBAAsB,GAAGzC,KAAK,CAACE,gBAAgB,CAAC,UAAU,CAAC;EACjE,IAAI,CAACuC,sBAAsB,IAAI,CAACA,sBAAsB,CAACrC,MAAM,EAAE;IAC7D;EACF;EAEA,MAAMP,aAAa,GAAG,qBAAuBG,KAAK,CAAC0C,mBAAmB,CAAC;IACrEC,OAAO,EAAE;EACX,CAAC,CAAE;EACH,MAAMC,OAAO,GAAGhD,qBAAqB,CACnCC,aAAa,EACbC,WAAW,EACXC,KAAK,EACLC,KACF,CAAC;EAED,IAAI4C,OAAO,EAAE;IACX;EACF;EAEAlB,yBAAyB,CACvB7B,aAAa,EAAE4C,sBAAsB,EAAE1C,KAAK,EAAE6B,MAChD,CAAC;AACH,CAAC,EAAE;EACDiB,gBAAgB,EAAE,IAAI;EACtBC,IAAI,EAAE;IACJC,IAAI,EAAE;MACJC,WAAW,EAAE,0HAA0H;MACvIC,GAAG,EAAE;IACP,CAAC;IACDC,OAAO,EAAE,MAAM;IACfC,MAAM,EAAE,CACN;MACEC,oBAAoB,EAAE,KAAK;MAC3BC,UAAU,EAAE;QACVvD,WAAW,EAAE;UACXkD,WAAW,EAAE;AACzB;AACA;AACA;AACA;AACA,4DAA4D;UAChDM,IAAI,EAAE;QACR;MACF,CAAC;MACDA,IAAI,EAAE;IACR,CAAC,CACF;IACDA,IAAI,EAAE;EACR;AACF,CAAC,CAAC;AAAAC,MAAA,CAAAlB,OAAA,GAAAA,OAAA,CAAA1C,OAAA","ignoreList":[]}